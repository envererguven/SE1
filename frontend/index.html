<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song Insertion and Search</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Singer and Song Manager</h1>

        <!-- Add Section -->
        <div class="card mb-4">
            <div class="card-header">Add New Singer and Song</div>
            <div class="card-body">
                <div id="addMessage" class="alert" style="display: none;"></div>
                <div class="mb-3">
                    <label for="singer" class="form-label">Singer</label>
                    <input type="text" class="form-control" id="singer" placeholder="Enter singer name">
                </div>
                <div class="mb-3">
                    <label for="song" class="form-label">Song</label>
                    <input type="text" class="form-control" id="song" placeholder="Enter song title">
                </div>
                <button class="btn btn-primary" onclick="addSong()">Add</button>
            </div>
        </div>

        <!-- Search Section -->
        <div class="card">
            <div class="card-header">Search for Singer or Song</div>
            <div class="card-body">
                <div id="searchMessage" class="alert" style="display: none;"></div>
                <div class="mb-3">
                    <label for="query" class="form-label">Search Query</label>
                    <input type="text" class="form-control" id="query" placeholder="Enter singer or song to search">
                </div>
                <button class="btn btn-primary" onclick="searchSongs()">Search</button>
                <div id="results" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        async function addSong() {
            const singer = document.getElementById('singer').value.trim();
            const song = document.getElementById('song').value.trim();
            const addMessage = document.getElementById('addMessage');

            if (!singer || !song) {
                showMessage(addMessage, 'danger', 'Please enter both singer and song.');
                return;
            }

            try {
                const response = await fetch('http://localhost:5000/add_song', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ singer, song })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();

                if (data.status === 'success') {
                    showMessage(addMessage, 'success', data.message || 'Song added successfully!');
                    document.getElementById('singer').value = '';
                    document.getElementById('song').value = '';
                } else {
                    showMessage(addMessage, 'danger', data.message || 'Failed to add song.');
                }
            } catch (error) {
                showMessage(addMessage, 'danger', 'Error adding song: ' + error.message);
            }
        }

        async function searchSongs() {
            const query = document.getElementById('query').value.trim();
            const searchMessage = document.getElementById('searchMessage');
            const resultsDiv = document.getElementById('results');

            if (!query) {
                showMessage(searchMessage, 'danger', 'Please enter a search query.');
                resultsDiv.innerHTML = '';
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/search?query=${encodeURIComponent(query)}`);

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const data = await response.json();

                if (data.status === 'error') {
                    showMessage(searchMessage, 'danger', data.message || 'Search failed.');
                    resultsDiv.innerHTML = '';
                    return;
                }

                const results = data.results || [];

                if (results.length === 0) {
                    showMessage(searchMessage, 'info', 'No results found.');
                    resultsDiv.innerHTML = '';
                } else {
                    showMessage(searchMessage, 'success', `${results.length} result(s) found.`);
                    let table = '<table class="table table-striped"><thead><tr><th>Singer</th><th>Song</th></tr></thead><tbody>';
                    results.forEach(item => {
                        table += `<tr><td>${item.singer || 'N/A'}</td><td>${item.song || 'N/A'}</td></tr>`;
                    });
                    table += '</tbody></table>';
                    resultsDiv.innerHTML = table;
                }
            } catch (error) {
                showMessage(searchMessage, 'danger', 'Error searching: ' + error.message);
                resultsDiv.innerHTML = '';
            }
        }

        function showMessage(element, type, message) {
            element.className = `alert alert-${type}`;
            element.innerHTML = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
